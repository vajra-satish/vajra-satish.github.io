{
  "hash": "aca6539825b55123db5d666bcd17daa3",
  "result": {
    "markdown": "---\ntitle: \"Measuring Impact in an Experiment with Partial Compliance: HIV Status and Changes in Sexual Behavior\"\nauthor: \"Satish Bajracharya\"\ndate: \"2024-03-19\"\ncategories: [RCT, R, Stata]\nimage: \"image.jpg\"\nengine: \"knitr\"\n---\n\n::: {.cell}\n<style type=\"text/css\">\np {\n  text-align: justify\n}\n</style>\n:::\n\n\nWe use data from **\"The Demand for, and Impact of, Learning HIV Status\"** study in Malawi. The study uses a randomized controlled trial (RCT), where individuals were provided varying degrees of monetary incentives to learn about their HIV status after receiving an HIV Test. \n\n::: callout-note\nStudy: Thornton, Rebecca L. 2008. “The Demand for, and Impact of, Learning HIV Status.” American Economic Review, 98 (5): 1829-63. \n\nData file: [Click here](https://www.aeaweb.org/aer/data/dec08/20060732_data.zip)\n\nDetailed description of the intervention: [Click here](https://www.povertyactionlab.org/evaluation/demand-and-impact-learning-hiv-status-malawi)\n:::\n\nWe use the \"Thornton HIV Testing Data.dta\" for the analysis.\n\n## Import the data\n\n##### Execution in R\n\nThe data file is a Stata (.dta) file. To import the dataset in R, we will need to install the **haven** package in R and use the **read_dta()** function. Run the following code in R to install the haven package:\n\n```\ninstall.packages(\"haven\")\n```\n\nWhen you download the data file, it comes with a readme file. Please read the readme file to learn more about the variables. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(lmtest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n```{.r .cell-code}\nlibrary(sandwich)\n# import the .dta file\ndata <- read_dta(\"C:/Impact Evaluation/Regression Analysis/Data/Thornton HIV Testing Data.dta\")\n```\n:::\n\n\n##### Execution in Stata\n\nUse the cd command to import the dataset. \n\n\n::: {.cell engine.path='C:/Stata15/Stata-64.exe'}\n\n```{.stata .cell-code}\ncd \"C://Impact Evaluation\"\nuse \"Regression Analysis\\Data\\Thornton HIV Testing Data.dta\", clear \n```\n\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\n. cd \"C://Impact Evaluation\"\nC:\\Impact Evaluation\n\n. use \"Regression Analysis\\Data\\Thornton HIV Testing Data.dta\", clear \n```\n:::\n:::\n\n\n## Create treatment variable\n\nCreate a variable called treatment which takes on a value of 1 if the participant received any financial incentive, and otherwise takes on a value of 0. The variable tinc records the amount of monetary incentive received by the respondents. Label the value of 0 and 1 as Control and Treatment. \n\n##### Execution in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_1 <- data |>\n  filter(!is.na(tinc)) |> #remove na in tinc\n  mutate(treatment = ifelse(tinc > 0, 1, 0)) # create treatment variable\ndata_1$treatment <- factor(data_1$treatment, \n                       levels = c(0, 1),\n                       labels = c(\"Control\", \"Treatment\"))\n```\n:::\n\n\n##### Execution in Stata\n\n\n::: {.cell engine.path='C:/Stata15/Stata-64.exe'}\n\n```{.stata .cell-code}\ncd \"C://Impact Evaluation\"\nuse \"Regression Analysis\\Data\\Thornton HIV Testing Data.dta\", clear\ngenerate treatment = cond(tinc>0, 1, 0)\nlabel define treatment 0 \"Control\" 1 \"Treatment\"\nlabel val treatment treatment\n```\n\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\n. cd \"C://Impact Evaluation\"\nC:\\Impact Evaluation\n\n. use \"Regression Analysis\\Data\\Thornton HIV Testing Data.dta\", clear\n\n. generate treatment = cond(tinc>0, 1, 0)\n\n. label define treatment 0 \"Control\" 1 \"Treatment\"\n\n. label val treatment treatment\n```\n:::\n:::\n\n\n## Calculating the compliance rate\n\nIn this analysis, we try to study the effect of learning one's HIV status on the decision to purchase a condom. We focus on a sub-group of individuals who are sexually active and HIV positive. To do this, we will need to restrict our sample to the sexually active and HIV positive individuals, and calculate the compliance rate for this sub-group. \n\n::: callout-note\nBaseline data was collected in 2004 and follow up data was collected in 2005.\n\nVariable description:  \n**treatment**: takes on the value of 1 if individual received monetary incentive and 0 otherwise.  \n**hadsex12**: Indicator if reported having sex in the pas 12 months from baseline (1 = Yes, 0 = No).  \n**hiv2004**: HIV results (1 = HIV Positive, 0 = HIV Negative, -1 = Indeterminent)  \n**got**: Indicator if obtained HIV results (1 = learned HIV results)  \n**anycond**: Indicator of any condom purchased at the follow-up survey\n:::\n\n##### Execution in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_1 <- data_1 |>\n  filter( hadsex12 == 1, \n          hiv2004 == 1,\n          !is.na(got),\n          !is.na(anycond))\ndata_1 <- data_1 |>\n  mutate(followed_treatment = ifelse(treatment ==  \"Treatment\", got, 1-got))\ntrt_dat <- data_1 |>\n  filter(treatment == \"Treatment\") |>\n  select(followed_treatment) |>\n  group_by(followed_treatment) |>\n  summarize(Count = n()) |>\n  mutate(Percent = Count/sum(Count))\nprint(trt_dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 3\n  followed_treatment Count Percent\n               <dbl> <int>   <dbl>\n1                  0    12   0.286\n2                  1    30   0.714\n```\n:::\n\n```{.r .cell-code}\ncntrl_dat <- data_1 |>\n  filter(treatment == \"Control\") |>\n  select(followed_treatment) |>\n  group_by(followed_treatment) |>\n  summarize(Count = n()) |>\n  mutate(Percent = Count/sum(Count))\nprint(trt_dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 3\n  followed_treatment Count Percent\n               <dbl> <int>   <dbl>\n1                  0    12   0.286\n2                  1    30   0.714\n```\n:::\n\n```{.r .cell-code}\ntrt_dat$Percent[trt_dat$followed_treatment == 1] - cntrl_dat$Percent[trt_dat$followed_treatment == 0]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4142857\n```\n:::\n:::\n\n\nHere, 71.4% of the treatment group learned about their HIV status and 30% of the control group dis so. The compliance rate is the difference between the share of treated individuals in the treatment group(71.43%) and the share of treated individuals in the control group(30%). Hence, the compliance rate for the experiment is 41.43% (71.43% - 30%).\n\n## Calculating the Intent to Treat Effect and the Local Average Treatment Effect (LATE) estimate\n\nIn R we use the **lm ()** function to run a regression. In Stata we use the regress command for the same.\n\nTo use robust standard errors, we need to install the **sandwich** package and use **vcovHC()** function in the **coeftest()** function from the **lmtest** package. \n\n# Work in Progress",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}